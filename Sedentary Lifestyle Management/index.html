<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>.header-bar { background-color: transparent; }</style>
</head>
<body>
    <div id="overlay" onclick="closeNav()"></div>
    <div id="toast"></div>

        <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <a href="index.html">ğŸ“Š Dashboard</a>
        <a href="profile.html">ğŸ‘¤ User Profile</a>
        <a href="diet.html">ğŸ Diet Tracker</a>
        <a href="walking.html">ğŸ‘£ Walking</a>
        <a href="water.html">ğŸ’§ Water Tracker</a>
        <a href="sedentary.html">ğŸª‘ Sedentary Timer</a>
        <a href="stairs.html">ğŸªœ Stairs Tracker</a>
        <a href="sleep.html">ğŸ˜´ Sleep Manager</a>
        <a href="exercise.html">ğŸƒ Exercise</a>
    </div>

    <div class="header-bar">
        <span class="menu-icon" onclick="openNav()">&#9776;</span>
    </div>

    <div class="container" style="margin-top: 0;">
        <h2>ğŸ‘‹ Welcome Back</h2>
        <p>Click the menu icon (â˜°) to access tools.</p>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>ğŸ‘£ Steps</h3>
                <div class="stat-number" id="display-steps">0</div>
                <span>steps</span>
            </div>
            <div class="stat-card">
                <h3>ğŸ’§ Water</h3>
                <div class="stat-number" id="display-water">0</div>
                <span>mL</span>
            </div>
            <div class="stat-card">
                <h3>ğŸ˜´ Sleep</h3>
                <div class="stat-number" id="display-sleep">--</div>
                <span>hours</span>
            </div>
            <div class="stat-card">
                <h3>âš–ï¸ BMI</h3>
                <div class="stat-number" id="display-bmi">--</div>
                <span id="bmi-text" style="font-size:0.8em">--</span>
            </div>
        </div>

        <div class="stat-card" style="margin-top: 20px; border: none; background: white; padding: 0;">
            <h3>ğŸ“Š 7-Day Water Intake</h3>
            <canvas id="waterChart"></canvas>
        </div>
        
        <div style="text-align: center; margin-top: 40px;">
            <button onclick="clearAllData()" class="secondary" style="width: auto; font-size: 0.9em;">Clear All Data</button>
        </div>
    </div>

    <script>
        function openNav() { document.getElementById("mySidenav").style.width = "250px"; document.getElementById("overlay").style.display = "block"; }
        function closeNav() { document.getElementById("mySidenav").style.width = "0"; document.getElementById("overlay").style.display = "none"; }
        function showToast(msg) {
            const t = document.getElementById("toast"); t.textContent = msg; t.className = "show";
            setTimeout(() => { t.className = t.className.replace("show", ""); }, 3000);
        }

        window.onload = function() {
            const steps = localStorage.getItem('w_steps') || 0;
            document.getElementById('display-steps').textContent = Number(steps).toLocaleString();

            const water = localStorage.getItem('totalWater') || 0;
            document.getElementById('display-water').textContent = water;

            const sleepData = localStorage.getItem('sleepRecords');
            if (sleepData) {
                const records = JSON.parse(sleepData);
                if (records.length > 0) document.getElementById('display-sleep').textContent = records[0].hours;
            }

            const h = localStorage.getItem('profileHeight');
            const w = localStorage.getItem('profileWeight');
            if(h && w) {
                const heightInMeters = h / 100;
                const bmi = (w / (heightInMeters * heightInMeters)).toFixed(1);
                document.getElementById('display-bmi').textContent = bmi;
            }
            renderChart();
        };

        function renderChart() {
            const records = JSON.parse(localStorage.getItem('waterRecords') || '[]');
            const labels = [];
            const data = [];
            
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const dateStr = d.toLocaleDateString();
                labels.push(`${d.getMonth() + 1}/${d.getDate()}`);
                const dayTotal = records.filter(r => r.date === dateStr).reduce((sum, r) => sum + r.amount, 0);
                data.push(dayTotal);
            }

            const ctx = document.getElementById('waterChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{ label: 'Water (mL)', data: data, backgroundColor: '#3498db', borderRadius: 5 }]
                },
                options: { responsive: true, scales: { y: { beginAtZero: true } } }
            });
        }

        function clearAllData() {
            if(confirm('Are you sure you want to clear all data?')) { localStorage.clear(); location.reload(); }
        }
    </script>
</body>
</html>