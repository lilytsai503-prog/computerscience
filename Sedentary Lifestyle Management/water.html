<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Tracker</title>
    <link rel="stylesheet" href="style.css">
    <style>.header-bar { background-color: transparent; }</style>
</head>
<body>
    <div id="overlay" onclick="closeNav()"></div>
    <div id="toast"></div>

    <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <a href="index.html">ğŸ“Š Dashboard</a>
        <a href="profile.html">ğŸ‘¤ User Profile</a>
        <a href="diet.html">ğŸ Diet Tracker</a>
        <a href="walking.html">ğŸ‘£ Walking</a>
        <a href="water.html">ğŸ’§ Water Tracker</a>
        <a href="sedentary.html">ğŸª‘ Sedentary Timer</a>
        <a href="stairs.html">ğŸªœ Stairs Tracker</a>
        <a href="sleep.html">ğŸ˜´ Sleep Manager</a>
        <a href="exercise.html">ğŸƒ Exercise</a>
    </div>

    <div class="header-bar">
        <span class="menu-icon" onclick="openNav()">&#9776;</span>
    </div>

    <div class="container">
        <h2>ğŸ’§ Water Tracker</h2>
        <p style="color:#666;font-size:0.9em;">Record intake. Goal based on weight.</p>

        <div class="cup-container">
            <div class="cup">
                <div id="cupWater" class="water"></div>
            </div>
        </div>
        <div id="progressText" style="text-align:center;margin:10px 0;font-weight:bold;"></div>

        <label>Amount (mL):</label>
        <input type="number" id="waterAmount" placeholder="e.g., 250">
        <button id="addWaterBtn">Add</button>

        <div style="display:flex; gap:10px; justify-content:center; margin-top:10px;">
            <button onclick="quickAdd(250)" class="secondary small">+250ml</button>
            <button onclick="quickAdd(500)" class="secondary small">+500ml</button>
        </div>

        <div id="alertBox" style="text-align:center;margin-top:10px;"></div>
        <hr style="border:0;border-top:1px solid #eee;margin:20px 0;">

        <h3>History</h3>
        <div id="summary" style="text-align:center;color:#666;margin-bottom:10px;">No records yet.</div>
        <div style="overflow-x:auto;">
            <table id="recordsTable">
                <thead><tr><th>Date</th><th>Amount (mL)</th><th>Action</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
        <div style="text-align:center;margin-top:20px;">
            <button id="clearBtn" class="danger-btn small">Clear History</button>
        </div>
    </div>

    <script>
        function openNav() { document.getElementById("mySidenav").style.width = "250px"; document.getElementById("overlay").style.display = "block"; }
        function closeNav() { document.getElementById("mySidenav").style.width = "0"; document.getElementById("overlay").style.display = "none"; }
        function showToast(msg) {
            const t = document.getElementById("toast"); t.textContent = msg; t.className = "show";
            setTimeout(() => { t.className = t.className.replace("show", ""); }, 3000);
        }

        const waterAmount = document.getElementById('waterAmount');
        const addBtn = document.getElementById('addWaterBtn');
        const clearBtn = document.getElementById('clearBtn');
        const recordsTableBody = document.querySelector('#recordsTable tbody');
        const summary = document.getElementById('summary');
        const alertBox = document.getElementById('alertBox');
        const cupWater = document.getElementById('cupWater');
        const progressText = document.getElementById('progressText');

        let records = JSON.parse(localStorage.getItem('waterRecords') || '[]');
        let savedWeight = localStorage.getItem('profileWeight');
        let dailyGoal = (savedWeight && Number(savedWeight) > 0) ? Number(savedWeight) * 30 : 2000;

        function getTodayTotal() {
            const today = new Date().toLocaleDateString();
            return records.filter(r => r.date === today).reduce((a, b) => a + b.amount, 0);
        }

        function updateCup() {
            const total = getTodayTotal();
            const ratio = Math.min(total / dailyGoal, 1);
            const height = 100 - ratio * 100;
            cupWater.style.height = height + "%";
            progressText.textContent = `${total} / ${dailyGoal} ml`;

            if (total >= dailyGoal) {
                alertBox.innerHTML = `<span class="badge ok">ğŸ‰ Goal Reached!</span>`;
                cupWater.style.backgroundColor = "transparent";
            } else {
                alertBox.innerHTML = total > 0 ? `<span class="badge ok">Already: ${total} ml</span>` : "";
                cupWater.style.backgroundColor = "rgba(63, 169, 245, 0.55)";
            }
        }

        function addWaterRecord(amount) {
            if (amount <= 0) return showToast("Invalid amount.");
            const item = { id: Date.now(), amount, date: new Date().toLocaleDateString() };
            records.unshift(item);
            localStorage.setItem('waterRecords', JSON.stringify(records));
            
            let currentTotalVar = parseInt(localStorage.getItem('totalWater')) || 0;
            localStorage.setItem('totalWater', currentTotalVar + amount);

            waterAmount.value = "";
            render();
            showToast(`Added +${amount} mL`);
        }

        addBtn.addEventListener('click', () => addWaterRecord(Number(waterAmount.value)));
        window.quickAdd = function(val) { addWaterRecord(val); }

        clearBtn.addEventListener('click', () => {
            if (!confirm("Clear history?")) return;
            records = [];
            localStorage.removeItem('waterRecords');
            localStorage.setItem('totalWater', 0);
            render();
            showToast("Cleared");
        });

        window.deleteRecord = function(id) {
            const target = records.find(r => r.id === id);
            if(target) {
                let currentTotalVar = parseInt(localStorage.getItem('totalWater')) || 0;
                localStorage.setItem('totalWater', Math.max(0, currentTotalVar - target.amount));
            }
            records = records.filter(x => x.id !== id);
            localStorage.setItem('waterRecords', JSON.stringify(records));
            render();
        };

        function render() {
            recordsTableBody.innerHTML = "";
            summary.style.display = records.length === 0 ? "block" : "none";
            for (const r of records) {
                const tr = document.createElement("tr");
                tr.innerHTML = `<td>${r.date}</td><td>${r.amount}</td><td style="text-align:center"><button class="danger-btn small" onclick="deleteRecord(${r.id})">Ã—</button></td>`;
                recordsTableBody.appendChild(tr);
            }
            updateCup();
        }
        render();
    </script>
</body>
</html>