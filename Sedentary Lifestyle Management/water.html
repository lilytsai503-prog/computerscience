<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Tracker</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="overlay" onclick="closeNav()"></div>

    <!-- å´é‚Šæ¬„ -->
    <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <a href="index.html">ğŸ“Š Dashboard</a>
        <a href="profile.html">ğŸ‘¤ User Profile</a>
        <a href="water.html" style="color:white">ğŸ’§ Water Tracker</a>
        <a href="sedentary.html">ğŸª‘ Sedentary Timer</a>
        <a href="sleep.html">ğŸ˜´ Sleep Manager</a>
    </div>

    <div class="header-bar">
        <span class="menu-icon" onclick="openNav()">&#9776;</span>
    </div>

    <div class="container">
        <h2>ğŸ’§ Water Tracker</h2>
        <p style="color:#666;font-size:0.9em;">
            Record your daily water intake. The cup below decreases as you drink more today.
        </p>

        <!-- æ°´æ¯è¦–è¦º -->
        <div class="cup-container">
            <div class="cup">
                <div id="cupWater" class="water"></div>
            </div>
        </div>

        <label>Amount (mL):</label>
        <input type="number" id="waterAmount" placeholder="e.g., 250">

        <button id="addWaterBtn">Add</button>

        <div id="alertBox" style="text-align:center;margin-top:10px;"></div>

        <hr style="border:0;border-top:1px solid #eee;margin:20px 0;">

        <h3>History</h3>
        <div id="summary" style="text-align:center;color:#666;margin-bottom:10px;">No records yet.</div>

        <div style="overflow-x:auto;">
            <table id="recordsTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Amount (mL)</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div style="text-align:center;margin-top:20px;">
            <button id="clearBtn" class="danger-btn small">Clear History</button>
        </div>
    </div>

    <script>
        function openNav() {
            document.getElementById("mySidenav").style.width = "250px";
            document.getElementById("overlay").style.display = "block";
        }
        function closeNav() {
            document.getElementById("mySidenav").style.width = "0";
            document.getElementById("overlay").style.display = "none";
        }

        const waterAmount = document.getElementById('waterAmount');
        const addBtn = document.getElementById('addWaterBtn');
        const clearBtn = document.getElementById('clearBtn');
        const recordsTableBody = document.querySelector('#recordsTable tbody');
        const summary = document.getElementById('summary');
        const alertBox = document.getElementById('alertBox');
        const cupWater = document.getElementById('cupWater');

// è®€å–é£²æ°´ç´€éŒ„
let records = JSON.parse(localStorage.getItem('waterRecords') || '[]');

// â¬‡ï¸ è®€å–é«”é‡ï¼ˆå‡è¨­å­˜æˆ { weight: 50 } é€™æ¨£ï¼‰
let profile = JSON.parse(localStorage.getItem('profile') || '{}');

// â¬‡ï¸ è¨­å®šæ¯æ—¥ç›®æ¨™
let dailyGoal = 2000;  // é è¨­ 2000 c.c.

if (profile.weight && Number(profile.weight) > 0) {
    dailyGoal = Number(profile.weight) * 30;  
}

// è¨ˆç®—ä»Šæ—¥é£²æ°´ç¸½é‡
function getTodayTotal() {
    const today = new Date().toLocaleDateString();
    return records
        .filter(r => r.date === today)
        .reduce((a, b) => a + b.amount, 0);
}

// æ›´æ–°æ°´æ¯ + æ˜¯å¦é”æ¨™
function updateCup() {
    const total = getTodayTotal();
    const ratio = Math.min(total / dailyGoal, 1);
    const height = 100 - ratio * 100;
    cupWater.style.height = height + "%";

    // é¡¯ç¤ºå·²é”æ¨™
    const alertBox = document.getElementById('alertBox');
    if (total >= dailyGoal) {
        alertBox.innerHTML = `<span class="badge ok">ğŸ‰ æœ¬æ—¥é£²æ°´å·²é”æ¨™ï¼</span>`;
    }
}


        function updateCup() {
            const total = getTodayTotal();
            const ratio = Math.min(total / dailyGoal, 1);
            const height = 100 - ratio * 100;
            cupWater.style.height = height + "%";
        }

        addBtn.addEventListener('click', () => {
            alertBox.innerHTML = "";
            const amount = Number(waterAmount.value);
            if (amount <= 0) return alert("Please enter a valid amount.");

            const item = {
                id: Date.now(),
                amount,
                date: new Date().toLocaleDateString()
            };

            records.unshift(item);
            localStorage.setItem('waterRecords', JSON.stringify(records));
            waterAmount.value = "";
            render();

            alertBox.innerHTML = `<span class="badge ok">+${amount} ml</span>`;
        });

        clearBtn.addEventListener('click', () => {
            if (!confirm("Clear all history?")) return;
            records = [];
            localStorage.removeItem('waterRecords');
            render();
            alertBox.innerHTML = "";
        });

        function render() {
            recordsTableBody.innerHTML = "";
            if (records.length === 0) {
                summary.style.display = "block";
            } else {
                summary.style.display = "none";
            }

            for (const r of records) {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${r.date}</td>
                    <td>${r.amount}</td>
                    <td style="text-align:center">
                        <button class="danger-btn small" onclick="deleteRecord(${r.id})">Ã—</button>
                    </td>
                `;
                recordsTableBody.appendChild(tr);
            }

            updateCup();
        }

        window.deleteRecord = function(id) {
            records = records.filter(x => x.id !== id);
            localStorage.setItem('waterRecords', JSON.stringify(records));
            render();
        };

        
        render();
    </script>
</body>
</html>
