<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Tracker</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="overlay" onclick="closeNav()"></div>

    <!-- å´é‚Šæ¬„ -->
    <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <a href="index.html">ğŸ“Š Dashboard</a>
        <a href="profile.html">ğŸ‘¤ User Profile</a>
        <a href="water.html" style="color:white">ğŸ’§ Water Tracker</a>
        <a href="sedentary.html">ğŸª‘ Sedentary Timer</a>
        <a href="sleep.html">ğŸ˜´ Sleep Manager</a>
    </div>

    <div class="header-bar">
        <span class="menu-icon" onclick="openNav()">&#9776;</span>
    </div>

    <div class="container">
        <h2>ğŸ’§ Water Tracker</h2>
        <p style="color:#666;font-size:0.9em;">
            Record your daily water intake. The cup below decreases as you drink more today.
        </p>

        <!-- æ°´æ¯è¦–è¦º -->
        <div class="cup-container">
            <div class="cup">
                <div id="cupWater" class="water"></div>
            </div>
        </div>

        <!-- â­ æ–°å¢ï¼šé¡¯ç¤ºå–æ°´é€²åº¦æ–‡å­— -->
        <div id="progressText" style="text-align:center;margin:10px 0;color:#555;font-weight:600;"></div>

        <label>Amount (mL):</label>
        <input type="number" id="waterAmount" placeholder="e.g., 250">

        <button id="addWaterBtn">Add</button>

        <div id="alertBox" style="text-align:center;margin-top:10px;"></div>

        <hr style="border:0;border-top:1px solid #eee;margin:20px 0;">

        <h3>History</h3>
        <div id="summary" style="text-align:center;color:#666;margin-bottom:10px;">No records yet.</div>

        <div style="overflow-x:auto;">
            <table id="recordsTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Amount (mL)</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div style="text-align:center;margin-top:20px;">
            <button id="clearBtn" class="danger-btn small">Clear History</button>
        </div>
    </div>

    <script>
        /* ===== å´é‚Šæ¬„ ===== */
        function openNav() {
            document.getElementById("mySidenav").style.width = "250px";
            document.getElementById("overlay").style.display = "block";
        }
        function closeNav() {
            document.getElementById("mySidenav").style.width = "0";
            document.getElementById("overlay").style.display = "none";
        }

        /* ===== DOM ===== */
        const waterAmount = document.getElementById('waterAmount');
        const addBtn = document.getElementById('addWaterBtn');
        const clearBtn = document.getElementById('clearBtn');
        const recordsTableBody = document.querySelector('#recordsTable tbody');
        const summary = document.getElementById('summary');
        const alertBox = document.getElementById('alertBox');
        const cupWater = document.getElementById('cupWater');
        const progressText = document.getElementById('progressText');

        /* ===== è®€å–é£²æ°´ç´€éŒ„ ===== */
        let records = JSON.parse(localStorage.getItem('waterRecords') || '[]');

        /* ===== è®€å–é«”é‡ï¼ˆfrom profile.htmlï¼‰ ===== */
        let profile = JSON.parse(localStorage.getItem('profile') || '{}');

        /* ===== æ¯æ—¥å–æ°´ç›®æ¨™ ===== */
        let dailyGoal = 2000;
        if (profile.weight && Number(profile.weight) > 0) {
            dailyGoal = Number(profile.weight) * 30;
        }

        /* ===== ä»Šæ—¥å–æ°´é‡ ===== */
        function getTodayTotal() {
            const today = new Date().toLocaleDateString();
            return records
                .filter(r => r.date === today)
                .reduce((a, b) => a + b.amount, 0);
        }

        /* ===== æ›´æ–°æ°´æ¯ ===== */
        function updateCup() {
            const total = getTodayTotal();
            const ratio = Math.min(total / dailyGoal, 1);
            const height = 100 - ratio * 100;
            cupWater.style.height = height + "%";

            // æ›´æ–°é€²åº¦æ–‡å­—
            progressText.textContent = `${total} / ${dailyGoal} ml`;

            // é”æ¨™æç¤º
            if (total >= dailyGoal) {
                alertBox.innerHTML = `<span class="badge ok">ğŸ‰ æœ¬æ—¥é£²æ°´å·²é”æ¨™ï¼</span>`;
            }
        }

        /* ===== æ–°å¢ç´€éŒ„ ===== */
        addBtn.addEventListener('click', () => {
            alertBox.innerHTML = "";
            const amount = Number(waterAmount.value);
            if (amount <= 0) return alert("Please enter a valid amount.");

            const item = {
                id: Date.now(),
                amount,
                date: new Date().toLocaleDateString()
            };

            records.unshift(item);
            localStorage.setItem('waterRecords', JSON.stringify(records));
            waterAmount.value = "";
            render();

            alertBox.innerHTML = `<span class="badge ok">+${amount} ml</span>`;
        });

        /* ===== æ¸…é™¤ç´€éŒ„ ===== */
        clearBtn.addEventListener('click', () => {
            if (!confirm("Clear all history?")) return;
            records = [];
            localStorage.removeItem('waterRecords');
            render();
            alertBox.innerHTML = "";
        });

        /* ===== é¡¯ç¤ºè¡¨æ ¼ ===== */
        function render() {
            recordsTableBody.innerHTML = "";

            summary.style.display = records.length === 0 ? "block" : "none";

            for (const r of records) {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${r.date}</td>
                    <td>${r.amount}</td>
                    <td style="text-align:center">
                        <button class="danger-btn small" onclick="deleteRecord(${r.id})">Ã—</button>
                    </td>
                `;
                recordsTableBody.appendChild(tr);
            }

            updateCup();
        }

        /* ===== åˆªé™¤å–®ç­† ===== */
        window.deleteRecord = function(id) {
            records = records.filter(x => x.id !== id);
            localStorage.setItem('waterRecords', JSON.stringify(records));
            render();
        };

        /* ===== åˆå§‹åŒ– ===== */
        render();
    </script>

</body>
</html>
